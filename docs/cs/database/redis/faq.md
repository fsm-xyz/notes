# 见过的坑

## OOM

项目的一些key未设置过期时间, 导致内存爆了, 集群不能正确同步数据

设置合适的超时时间

## 删除大key

记录活动的一个大hash key(400-500万), 夜间删除时导致整体超时

可以按天建key, 按天删除, 不要同一时间删除

## 超时

配置文件设置的超时时间太短, 导致io timeout

加长超时时间

## 上锁异常

先setnx, 然后expire, 非原子性操作, 导致异常

直接用set, 或者用lua脚本执行

## 获取数据

拉取全量, 导致其他操作超时, io变大

可以用增量操作, 避免一次拉取太多, 阻塞其他操作

## 连接数配置

连接数配置不合理，导致io超时
