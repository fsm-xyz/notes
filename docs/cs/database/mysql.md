# MySQL

### 面试问题

#### 死锁

#### 死锁避免

1. 改造业务，使得顺序加锁
2. 减少事务的范围，持有锁的时间
3. 使用乐观锁

#### 死锁监控

1. 设置参数，把死锁信息打到MySQL日志
2. 定期检查死锁情况
3. 监控锁等待

#### 行锁

通过纪录锁，间隙锁，组合锁

主键上锁，唯一索引上锁

通过其他的锁锁定主键索引

#### 数据库读写分离保持数据一致性

+ 容忍延迟，分析业务场景，如果不需要就没有必要处理
+ 半同步复制，设置从库同步成功，主库再进行响应
+ 强制读主，全从主库读写
+ 选择性读主，把记录保存至redis等，进行选择主还是从

#### 缓存一致性

##### 写时加载缓存

先写redis,再写MySQL(不推荐)

##### 读时加载缓存

更新MySQL，删除缓存，读的时候加载缓存

#### binlog消费

#### 消息队列

#### 延时双删

解决mysql主从读写的延迟

多次删除

#### 过期时间


#### facebook的租约

#### uber的版本方案