LSM (Log-Structured Merge-Tree) 是一种用于存储和检索数据的架构，尤其适用于写密集型工作负载。它的核心思想是将随机写入转换为顺序写入，从而提高写入性能。

LSM 树主要由以下几个部分组成：

### 内存中的数据结构 (Memtable)
---
这是一个内存中的数据结构，用于暂存新的写入操作。它通常是一个**跳跃表 (Skip List)** 或**红黑树 (Red-Black Tree)**，可以高效地支持插入、更新和删除操作。所有新的写入都会首先进入 Memtable，这些操作都是顺序追加到内存中的，速度非常快。

### 磁盘上的数据结构 (SSTable/LSM 文件)
---
当 Memtable 的大小达到预设阈值时，它会被“冻结”，并以**排序好的键值对 (Sorted String Table, SSTable)** 的形式写入磁盘。SSTable 是一个不可变的文件，其中的键值对是按照键的大小排序的。

一个完整的 LSM 树由多个层级组成，每一层都包含一个或多个 SSTable。通常，越靠近顶层的 SSTable 越新，而越底层的 SSTable 越旧。

### 合并与压缩 (Compaction)
---
这是 LSM 树最核心的机制。由于数据不断写入，会产生越来越多的 SSTable。为了避免 SSTable 数量过多影响读取性能，LSM 树会周期性地将不同层级的 SSTable 进行**合并 (Merge)**。

合并的过程类似于归并排序，它会从不同层级中选择一些 SSTable，将它们的数据进行合并，并生成一个新的、更小的 SSTable。在这个过程中，旧的、无效的数据（如被删除或更新的数据）会被清理掉。

### 总结
---
LSM 树通过以下三个关键步骤实现了高性能的写入：

1.  **内存写入**：将所有新数据写入 Memtable，利用内存的高速特性。
2.  **磁盘写入**：将 Memtable 周期性地刷新到磁盘，形成不可变的 SSTable，将随机写入转换为顺序写入。
3.  **合并压缩**：在后台持续进行，清理冗余数据，优化磁盘空间和读取性能。

这种结构牺牲了一定的读取性能（因为读取时可能需要查询多个 SSTable），但显著提升了写入吞吐量，这使其成为许多现代数据库（如 Cassandra、ScyllaDB、RocksDB、LevelDB）的首选存储引擎。