# 内存泄漏

## 现象

redis的报timeout导致服务内存持续上涨

### 分析

通过监控图查看如下参数，进行原因分析

接口平均耗时
内存情况
Goroutinue数量
CPU

### 结论

从以上图中分析，看出主要是协程数量增加，导致内存升高，耗尽，CPU影响比较小

排除死循环，死循环是迅速占满CPU

排除Goroutinue泄漏，如果是这个的话，Goroutinue会持续上升


1. 下游请求设置了超时返回, 超时之后请求返回，但是调用数据库的请求并没有设置超时返回，下游失败之后一直在重复请求(下游服务，客户端)，导致数据库的请求增加，资源不释放，恶性循环
2. 其他go func起来的请求，没有处理超时，ctx传递的时候新建了一份，超时不释放，所以资源消耗一直增加
