TLS 1.3 的交互流程相比于之前的版本进行了简化，主要目标是提高安全性和减少握手延迟。整个握手过程可以分为以下几个关键步骤：

### 1. 客户端发起 Hello
---
* **ClientHello**: 客户端向服务器发送 `ClientHello` 消息，表明自己希望建立一个安全连接。这个消息包含以下关键信息：
    * **支持的 TLS 版本**: 客户端只提供 TLS 1.3。
    * **支持的密码套件 (Cipher Suites)**: 这是一组加密算法的集合，包括密钥交换算法、身份验证算法、对称加密算法等。TLS 1.3 中，密钥交换和对称加密是分开的。
    * **密钥共享 (Key Share)**: 这是 TLS 1.3 的一个核心改进。客户端会提前生成一个**临时密钥对**，并将公钥发送给服务器。这样，服务器收到 `ClientHello` 之后就可以直接计算出共享密钥，从而节省了一个往返时间 (RTT)。TLS 1.3 默认使用 **ECDHE** (Elliptic Curve Diffie-Hellman Ephemeral) 密钥交换算法。
    * **支持的扩展**: 包括 `supported_versions` (协商 TLS 版本)、`supported_groups` (协商椭圆曲线群)、`signature_algorithms` (协商签名算法) 等。

### 2. 服务器处理 Hello 并响应
---
* **ServerHello**: 服务器收到 `ClientHello` 后，会选择一个最优的密码套件和密钥共享参数，并回复 `ServerHello` 消息。
* **EncryptedExtensions**: 服务器发送 `EncryptedExtensions` 消息，里面包含一些只有在握手完成后才能知道的扩展信息。这个消息是加密的，只有客户端和服务器才能解密。
* **Certificate**: 服务器发送 `Certificate` 消息，提供服务器的公钥证书链，用于客户端验证服务器的身份。这个消息也是加密的。
* **CertificateVerify**: 服务器发送 `CertificateVerify` 消息，包含一个使用其私钥对握手消息哈希值的签名。客户端可以用服务器的公钥验证这个签名，以证明服务器确实拥有与其证书匹配的私钥。这个消息也是加密的。
* **Finished**: 服务器发送 `Finished` 消息，这是一个包含握手消息哈希值和共享密钥的 MAC (Message Authentication Code)。客户端和服务器都可以使用共享密钥验证这个 MAC，以确保握手过程没有被篡改。这个消息是加密的。

### 3. 客户端验证并发送 Finished
---
* **Finished**: 客户端收到服务器发送的 `Finished` 消息并验证通过后，自己也会计算一个 `Finished` 消息并发送给服务器。

### 4. 握手完成，开始加密通信
---
* **Application Data**: 当双方都成功验证了对方的 `Finished` 消息后，TLS 握手完成。从这一刻开始，所有应用层数据都将使用协商好的密钥和加密算法进行加密传输。

### TLS 1.3 握手流程的简化与优势
---
* **1-RTT 握手**: 在理想情况下，TLS 1.3 只需要一个往返时间 (1-RTT) 就可以完成握手。相比于 TLS 1.2 的 2-RTT，这大大减少了延迟。这是因为客户端在 `ClientHello` 中就发送了密钥共享信息，服务器可以立即开始计算共享密钥。
* **0-RTT 恢复**: TLS 1.3 支持 **0-RTT** (Zero Round-Trip Time) 恢复。如果客户端之前已经与服务器建立过连接，它可以使用预共享密钥 (PSK) 和握手消息，在 `ClientHello` 中直接发送加密的应用数据。这对于经常需要恢复连接的应用（如移动端应用）来说，能显著提升性能。
* **去除冗余和不安全特性**: TLS 1.3 彻底删除了许多不安全的密码套件和特性，例如 SHA-1、RC4、CBC 模式等，只保留了更强大的算法，从而提高了安全性。