### 什么是 WebSocket？

WebSocket 是一种在单个 TCP 连接上进行全双工通信的协议，它允许服务器主动向客户端推送数据，而不需要客户端不断地发起请求。

在传统的 **HTTP** 通信中，客户端向服务器发送请求，服务器响应，然后连接关闭。这种模式是单向的，且每次请求都会产生额外的开销。

相比之下，**WebSocket** 建立了一个持久连接，一旦握手成功，服务器和客户端就可以像打电话一样，随时双向发送数据，这大大提高了通信效率，特别适用于需要实时数据更新的场景，比如：

* **实时聊天**：用户发送消息后，服务器可以立即推送到其他用户，实现秒级响应。
* **在线游戏**：服务器可以实时同步玩家的位置、动作和游戏状态。
* **股票行情**：服务器可以实时推送最新的股票价格和交易信息。

---

### WebSocket 的基本原理

WebSocket 的工作流程可以分为两个主要阶段：**握手**和**数据传输**。

1.  **握手 (Handshake)**：
    * **客户端**发起一个特殊的 HTTP 请求，请求头中包含 `Upgrade: websocket` 和 `Connection: Upgrade` 等字段。
    * **服务器**收到请求后，如果支持 WebSocket，会返回一个 `101 Switching Protocols` 响应，表示同意切换协议。
    * **握手成功**后，底层的 TCP 连接不再用于 HTTP 通信，而是切换为 WebSocket 协议，进入持久连接状态。

2.  **数据传输**：
    * 连接建立后，服务器和客户端可以通过这个持久连接，以**帧 (Frame)** 的形式双向传输数据。
    * 每一帧都包含一个 Opcode（操作码），用于标识数据类型，比如文本、二进制数据、Ping/Pong 消息等。
    * 通过这种方式，双方可以持续、高效地进行通信，避免了重复的 HTTP 请求开销。

---

### WebSocket 的核心优势

* **双向通信 (Full-duplex)**：服务器可以主动向客户端推送数据，不再需要客户端轮询。
* **低开销**：握手后，数据传输的协议头非常小，只有几字节，而 HTTP 的协议头则要大得多。
* **持久连接**：一次握手后，连接长期保持，减少了频繁创建和销毁连接的开销。
* **跨域通信**：WebSocket 原生支持跨域，可以轻松处理不同域名下的通信问题。

---

### WebSocket 的常见面试问题

在面试中，关于 WebSocket 的问题通常会围绕其原理、优势、与 HTTP 的区别以及如何应用展开。以下是一些常见的面试点：

1.  **WebSocket 和 HTTP 的核心区别是什么？**
    * **连接类型**：HTTP 是**无状态、短连接**，请求-响应模型；WebSocket 是**有状态、长连接**，全双工通信。
    * **通信方向**：HTTP 只能由客户端发起请求；WebSocket 可以双向发起通信。
    * **开销**：HTTP 每次请求都有较大的头部开销；WebSocket 握手后数据帧开销极小。

2.  **WebSocket 和 HTTP 轮询（Polling）有什么区别？**
    * **HTTP 轮询**：客户端每隔一段时间（比如 1 秒）就向服务器发起请求，询问是否有新数据。这会造成大量的 HTTP 请求，浪费服务器资源。
    * **WebSocket**：服务器有数据时**主动推送**，客户端无需频繁请求。这大大提高了实时性和效率。

3.  **WebSocket 的握手过程是怎样的？**
    * 可以详细描述握手时的 HTTP 协议切换过程，以及请求头中的 `Upgrade` 和 `Connection` 字段，还有服务器返回的 `101` 状态码。

4.  **WebSocket 为什么能实现双向通信？**
    * 因为 WebSocket 协议**建立在 TCP 协议之上**，握手成功后，它利用了 TCP 的长连接特性，使得数据流可以双向流动，从而实现全双工通信。

5.  **在什么场景下会优先考虑使用 WebSocket？**
    * 所有需要**高实时性**和**低延迟**的场景，比如实时聊天、在线协作、多人游戏、直播弹幕等。

6.  **如果 WebSocket 连接断开怎么办？**
    * 可以讨论如何实现**重连机制**。通常的做法是，在连接断开后，设置一个定时器，等待一段时间后再次发起连接请求，并可以考虑使用**指数退避**（Exponential Backoff）算法来逐步增加重连的间隔时间，避免给服务器造成过大压力。

掌握这些核心点，不仅能帮助你应对面试，也能更好地理解和应用 WebSocket 技术。