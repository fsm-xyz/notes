# 资源统计

在容器（如 Docker 或 Kubernetes Pod）内统计线程数量，与在普通 Linux 服务器上操作基本一致，但需要注意容器的**隔离性**和使用的**基础镜像**（如 Alpine 镜像可能缺少某些命令）。

以下是几种常用的统计方法：

---

### 1. 使用 `ps` 命令（最常用）

这是最直接的方法，通过 `H` 参数查看线程，再结合 `wc` 统计行数。

* **统计容器内所有线程总数：**
```bash
ps -eLf | wc -l

```


* **查看特定进程的线程数：**
如果你知道进程 ID（PID），比如是 1：
```bash
ps -hH -p 1 | wc -l

```



### 2. 查看 `/proc` 伪文件系统（最底层、最可靠）

在 Linux 中，每个进程的信息都存储在 `/proc/[PID]` 目录下。这是最准确的方法，即使容器里没有安装 `ps` 或 `top` 也能用。

* **直接读取特定进程的 `status` 文件：**
```bash
cat /proc/[PID]/status | grep Threads

```


* **统计 `task` 目录下的项目数：**
Linux 为每个线程在 `task` 文件夹下创建一个子目录。
```bash
ls /proc/[PID]/task | wc -l

```



### 3. 使用 `top` 或 `htop`

如果你在容器内需要实时观察：

* **top 命令：** 输入 `top` 后，按下 **`H`** 键，可以切换显示线程模式。或者直接运行：
```bash
top -H -p [PID]

```


* **htop 命令：** 如果容器里安装了 `htop`，它默认会用不同的颜色标注线程，并在顶端显示总线程数。

### 4. 在容器外（宿主机）统计

如果你不想进入容器内部，可以在宿主机上操作：

1. **获取容器的 PID：**
```bash
docker inspect --format '{{ .State.Pid }}' <容器名或ID>

```


2. **根据 PID 统计：**
```bash
ps -hH -p <PID> | wc -l

```



---
pgrep -P [PID] | wc -l

pstree -p [PID]：可以清晰看到该进程下挂了多少个子进程（小括号内是 PID）和线程（大括号内）。